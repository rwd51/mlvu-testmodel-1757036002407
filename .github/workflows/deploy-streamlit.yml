name: ğŸš€ Deploy to Streamlit Cloud

on:
  push:
    branches: [ main, master ]
  workflow_dispatch:

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
    - name: ğŸ“¥ Checkout Repository
      uses: actions/checkout@v4

    - name: ğŸ Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'

    - name: ğŸ“¦ Install Dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt

    - name: ğŸ” Validate Streamlit App
      run: |
        python -c "import streamlit as st; print('âœ… Streamlit import successful')"
        python -m py_compile streamlit_app.py
        echo "âœ… Streamlit app validation passed"

    - name: ğŸš€ Deployment Complete
      run: |
        echo "ğŸ¯ TestModel deployed to Streamlit Cloud!"
        echo "ğŸ“± App URL: https://share.streamlit.io/rwd51/mlvu-testmodel-1757036002407/main/streamlit_app.py"
        echo "ğŸ”— Alt URL: https://rwd51-mlvu-testmodel-1757036002407-streamlit-app-main.streamlit.app"

    - name: ğŸ“ Create Deployment Comment
      uses: actions/github-script@v7
      with:
        script: |
          const streamlitUrl = 'https://share.streamlit.io/rwd51/mlvu-testmodel-1757036002407/main/streamlit_app.py';
          const altUrl = 'https://rwd51-mlvu-testmodel-1757036002407-streamlit-app-main.streamlit.app';

          const { data: commits } = await github.rest.repos.listCommits({
            owner: context.repo.owner,
            repo: context.repo.repo,
            per_page: 1
          });

          if (commits.length > 0) {
            await github.rest.repos.createCommitComment({
              owner: context.repo.owner,
              repo: context.repo.repo,
              commit_sha: commits[0].sha,
              body: `ğŸ‰ **Streamlit App Deployed!**\n\n` +
                    `ğŸš€ **Launch App**: [${streamlitUrl}](${streamlitUrl})\n` +
                    `ğŸ”— **Alternative**: [${altUrl}](${altUrl})\n\n` +
                    `â±ï¸ App is live and ready to use!`
            });
          }
